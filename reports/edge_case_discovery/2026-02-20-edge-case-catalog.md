# Collector 엣지 케이스 100선 (2026-02-20)

본 문서는 `Collector` 프로젝트의 수집/출력/보안/운영 관점에서 우선 검증해야 할 엣지 케이스 100개를 정리한 카탈로그입니다.

## 1) 실행 환경/권한 (EC-001 ~ EC-010)
1. **EC-001 | PowerShell 버전 미달**: PowerShell 5.1 미만에서 실행할 때 시작 전 즉시 실패해야 한다.
2. **EC-002 | 관리자 권한 없음**: 관리자 권한 없이 실행 시 권한 필요한 수집만 실패하고 전체 파이프라인은 계속되어야 한다.
3. **EC-003 | WMI 서비스 중지**: `winmgmt`가 중지된 상태에서 사전 점검 단계가 명확한 오류로 중단해야 한다.
4. **EC-004 | 시스템 드라이브 공간 부족**: 최소 여유 공간 미달 시 안전 가드가 동작해 수집을 차단해야 한다.
5. **EC-005 | 출력 드라이브 공간 부족**: 결과 저장 직전 디스크 부족을 감지하고 저장 단계를 중단해야 한다.
6. **EC-006 | 중복 실행 Mutex 충돌**: 동일 호스트에서 동시 실행 시 두 번째 인스턴스가 즉시 거부되어야 한다.
7. **EC-007 | Global Mutex 권한 거부**: Global Mutex 생성 실패 시 Local Mutex로 폴백되어야 한다.
8. **EC-008 | 실행 정책 제한**: 서명/실행 정책으로 스크립트 로드가 막힐 때 원인 메시지가 명확해야 한다.
9. **EC-009 | OneDrive/동기화 경로 실행**: 동기화 충돌 상황에서도 파일 잠금 오류가 예외 처리되어야 한다.
10. **EC-010 | 로캘/코드페이지 차이**: 비영문 로캘에서 로그/문자열 처리 결과가 깨지지 않아야 한다.

## 2) 입력/파라미터 검증 (EC-011 ~ EC-020)
11. **EC-011 | 잘못된 OutputFormat 값**: `ValidateSet` 위반 입력 시 파라미터 바인딩 단계에서 실패해야 한다.
12. **EC-012 | EventLogFormat 오타**: 허용되지 않은 포맷 입력 시 즉시 오류를 반환해야 한다.
13. **EC-013 | LookbackDays 최소값 미만**: `0` 이하 입력을 거부해야 한다.
14. **EC-014 | LookbackDays 최대값 초과**: `366` 이상 입력을 거부해야 한다.
15. **EC-015 | modules에 미지원 이름 포함**: 미지원 모듈명이 있을 때 실행 전 검증 실패해야 한다.
16. **EC-016 | modules 중복 입력**: 중복 모듈이 들어와도 한 번만 실행되어야 한다.
17. **EC-017 | OutputPath 공백 문자열**: 공백만 전달될 경우 유효성 실패로 중단해야 한다.
18. **EC-018 | OutputPath 상대경로/절대경로 혼용**: 경로 해석이 일관되고 의도한 위치에 저장되어야 한다.
19. **EC-019 | Encrypt만 지정하고 키 미입력**: 암호화 키 입력 플로우가 명확하게 강제되어야 한다.
20. **EC-020 | WhatIf와 조합 파라미터**: `-WhatIf` 사용 시 실제 파일 생성/삭제가 발생하지 않아야 한다.

## 3) 공통 수집 계약/오류 격리 (EC-021 ~ EC-030)
21. **EC-021 | Get-CimSafe 클래스 미존재**: 선택적 클래스 부재는 경고/디버그 로그 후 빈 결과로 처리되어야 한다.
22. **EC-022 | Get-CimSafe 접근 거부**: 권한 오류 발생 시 예외가 상위로 누락되지 않고 표준 로그로 남아야 한다.
23. **EC-023 | Invoke-Collection 반환 타입 null**: null 결과가 타입 판별에서 안전하게 처리되어야 한다.
24. **EC-024 | Invoke-Collection에서 문자열 오류 반환**: `"Error: ..."` 패턴을 실패로 정확히 분류해야 한다.
25. **EC-025 | 수집 블록 내부 무한 대기**: 타임아웃 또는 중단 메커니즘으로 전체 정지 상태를 방지해야 한다.
26. **EC-026 | 모듈 1개 실패 + 나머지 성공**: 실패 모듈만 격리되고 전체 보고서는 생성되어야 한다.
27. **EC-027 | StepTimings 비초기화**: 디버그 모드에서 타이밍 배열 null 예외가 발생하지 않아야 한다.
28. **EC-028 | 대량 객체 직렬화**: 깊은 객체 구조에서 JSON 직렬화 폴백 로직이 동작해야 한다.
29. **EC-029 | 민감정보 마스킹 누락 패턴**: 신규 키워드 변형(`apiKey`, `auth_token`)도 정책상 점검 가능해야 한다.
30. **EC-030 | 로그 함수 파일 쓰기 실패**: 디버그 로그 기록 실패가 본 실행을 중단시키지 않아야 한다.

## 4) 모듈별 수집 엣지 케이스 (EC-031 ~ EC-055)
31. **EC-031 | Hardware: CIM Provider 오류**: BIOS/CPU 조회 실패 시 Hardware 모듈만 부분 실패 처리되어야 한다.
32. **EC-032 | Hardware: 디스크 0개 반환**: 논리/물리 디스크 정보가 없어도 보고서 생성이 지속되어야 한다.
33. **EC-033 | Network: 비활성 NIC만 존재**: 어댑터 정보가 빈 상태여도 예외 없이 저장되어야 한다.
34. **EC-034 | Network: DNS 조회 지연**: 네트워크 조회 지연 시 타 모듈에 영향이 없어야 한다.
35. **EC-035 | OSConfig: OptionalFeature 클래스 미지원**: 기능 목록 수집 실패가 전체 실패로 번지지 않아야 한다.
36. **EC-036 | OSConfig: 시간 동기화 서비스 없음**: 서비스 부재 환경에서도 모듈이 종료되어야 한다.
37. **EC-037 | Virtualization: Hyper-V 모듈 없음**: Hyper-V 항목은 미지원 메시지로 폴백되어야 한다.
38. **EC-038 | Virtualization: Docker CLI 없음**: Docker 런타임 정보는 실패 원인 포함 폴백이어야 한다.
39. **EC-039 | Virtualization: WSL 비활성**: WSL 항목은 빈/미사용 상태로 처리되어야 한다.
40. **EC-040 | Services: 서비스 수 매우 많음**: 대량 서비스 목록에서도 성능 저하가 제한되어야 한다.
41. **EC-041 | Services: 접근 거부 서비스 포함**: 일부 서비스 조회 거부가 모듈 전체 실패를 유발하지 않아야 한다.
42. **EC-042 | Performance: 카운터 미존재**: 특정 카운터 부재 시 대체값 또는 오류 메시지로 처리해야 한다.
43. **EC-043 | Performance: 샘플링 중 예외**: 한 지표 실패가 나머지 지표 수집을 막지 않아야 한다.
44. **EC-044 | Security: Defender 미설치**: 백신 상태 수집은 미설치 메시지로 안전하게 반환해야 한다.
45. **EC-045 | Security: auditpol 권한 부족**: 감사정책 조회 실패 시 원인 문자열이 보고서에 남아야 한다.
46. **EC-046 | Security: 로컬 관리자 그룹 조회 실패**: SID 해석 오류 시 예외가 누락되지 않아야 한다.
47. **EC-047 | Inventory: 레지스트리 손상**: 설치 프로그램 목록 일부 키 손상 시 모듈이 지속되어야 한다.
48. **EC-048 | Inventory: 32비트/64비트 중 한쪽만 접근 가능**: 접근 가능한 영역만 수집해야 한다.
49. **EC-049 | AD: RSAT 미설치**: AD 모듈은 "미사용/미설치"로 종료되어야 한다.
50. **EC-050 | AD: 도메인 미가입 호스트**: AD 조회 실패가 명확한 폴백 문자열로 반환되어야 한다.
51. **EC-051 | AD: 일부 cmdlet만 사용 가능**: Forest 성공/Trust 실패 같은 부분 결과를 허용해야 한다.
52. **EC-052 | HA: FailoverClusters 모듈 없음**: HA 모듈이 우아하게 스킵되어야 한다.
53. **EC-053 | HA: Get-ClusterLog 경로 권한 부족**: 로그 생성 실패 시 경로 원인이 기록되어야 한다.
54. **EC-054 | HA: 클러스터 비구성 노드**: 비클러스터 서버에서 오류 대신 상태 메시지를 반환해야 한다.
55. **EC-055 | HA: NIC Teaming API 미지원 OS**: OS 버전 차이로 인한 cmdlet 부재를 처리해야 한다.

## 5) 이벤트 로그 수집 엣지 케이스 (EC-056 ~ EC-070)
56. **EC-056 | Security 로그 비관리자 접근**: 접근 거부를 빈 배열로 숨기지 말고 명시적 오류로 반환해야 한다.
57. **EC-057 | Security 로그 0개**: 조회 기간 내 이벤트 없음은 정상 빈 결과로 처리되어야 한다.
58. **EC-058 | System 로그 대용량(1GB+)**: MaxEvents 축소 가드가 동작해야 한다.
59. **EC-059 | Application 로그 대용량**: 대용량에서도 시간 초과 없이 제한 수집되어야 한다.
60. **EC-060 | Setup 로그 채널 비활성**: 비활성 채널은 스킵 + 디버그 로그가 남아야 한다.
61. **EC-061 | Winlogon/Operational 채널 미존재**: OS 에디션 차이를 안전하게 처리해야 한다.
62. **EC-062 | GroupPolicy/Operational 접근 거부**: 채널 접근 실패가 전체 로그 수집을 중단시키지 않아야 한다.
63. **EC-063 | LSM/Operational 이벤트 과다**: 100개 상한이 정상 적용되어야 한다.
64. **EC-064 | RCM/Operational 이벤트 없음**: 무이벤트는 오류가 아닌 정상 상태여야 한다.
65. **EC-065 | Diagnostics-Performance/Operational 이벤트 과다**: 성능 채널 조회 지연이 제어되어야 한다.
66. **EC-066 | 필터 미적용 채널 수집**: 지정된 비필터 채널이 `-LogName` 경로로 수집되는지 검증해야 한다.
67. **EC-067 | 필터 적용 채널 오탐**: `System/Application`에만 Level 필터가 적용되어야 한다.
68. **EC-068 | 로그 이름 특수문자 파일명 변환**: `/` 포함 채널명이 안전한 파일명으로 변환되어야 한다.
69. **EC-069 | 이벤트 메시지 초장문**: CSV/HTML 내 인코딩/줄바꿈 손상이 없어야 한다.
70. **EC-070 | 이벤트 메시지 null**: `Message` null 이벤트도 Export 단계가 실패하지 않아야 한다.

## 6) 병렬 실행/동시성 (EC-071 ~ EC-080)
71. **EC-071 | 병렬 태스크 수 1개**: 병렬 모드에서도 단일 태스크가 정상 완료되어야 한다.
72. **EC-072 | 병렬 태스크 수 CPU 코어 초과**: RunspacePool 상한 계산이 안전해야 한다.
73. **EC-073 | 특정 태스크 300초 타임아웃**: 타임아웃 태스크만 실패 처리되고 나머지는 완료되어야 한다.
74. **EC-074 | EndInvoke 예외 발생**: runspace 예외가 결과 집계에 누락되지 않아야 한다.
75. **EC-075 | 병렬 로그 파일 동시 기록**: 디버그 로그 경합 시 재시도 로직으로 손실을 줄여야 한다.
76. **EC-076 | 병렬 결과 순서 비결정성**: 결과 맵 키 기준으로 일관된 병합이 되어야 한다.
77. **EC-077 | runspace 내 라이브러리 로드 실패**: 해당 태스크 실패가 명시적으로 기록되어야 한다.
78. **EC-078 | 병렬 + Encrypt + Compress 동시 사용**: 후처리 단계 순서가 꼬이지 않아야 한다.
79. **EC-079 | 병렬 완료 직후 GC 강제 호출**: 리소스 정리 후 핸들 누수가 없어야 한다.
80. **EC-080 | 병렬 중 Ctrl+C 인터럽트**: 중단 시 Mutex/리소스가 정리되어야 한다.

## 7) 출력/암호화/압축/파일 처리 (EC-081 ~ EC-092)
81. **EC-081 | OutputDirectory 미존재**: 저장 전 명확한 오류로 실패해야 한다.
82. **EC-082 | OutputDirectory 쓰기 권한 없음**: 권한 오류가 상위까지 전파되어야 한다.
83. **EC-083 | JSON 직렬화 Depth 실패**: Depth 10 실패 시 Depth 5 폴백이 동작해야 한다.
84. **EC-084 | HTML 변환 중 null 속성 포함**: HTML 리포터가 null 안전해야 한다.
85. **EC-085 | CSV Flatten 중 중첩 배열**: CSV 리포트 생성이 예외 없이 완료되어야 한다.
86. **EC-086 | 이벤트 로그 파일명 타임스탬프 적용**: `Log_<Name>_<yyyyMMdd-HHmmss>.ext` 규칙이 유지되어야 한다.
87. **EC-087 | 결과 파일명 충돌(초 단위 동시 실행)**: 동일 타임스탬프 충돌 가능성을 점검해야 한다.
88. **EC-088 | 암호화 중 파일 잠금**: 잠금 파일에 대한 예외가 누락되지 않아야 한다.
89. **EC-089 | 암호화 후 원본 삭제 실패**: 평문 파일 잔존 시 경고/로그가 명확해야 한다.
90. **EC-090 | 잘못된 키로 복호화 시도**: 복호화 실패 메시지가 명확해야 한다.
91. **EC-091 | ZIP 생성 후 중간 파일 삭제 실패**: 삭제 실패가 전체 성공/실패 판단에 반영되어야 한다.
92. **EC-092 | DebugMode false에서 임시 산출물 정리**: 불필요 파일이 남지 않아야 한다.

## 8) 서명/보안/운영 거버넌스 (EC-093 ~ EC-100)
93. **EC-093 | collectors 스크립트 미서명**: 로더가 모듈 로드를 거부해야 한다.
94. **EC-094 | collectors 스크립트 HashMismatch**: 변조된 파일은 로드 거부되어야 한다.
95. **EC-095 | 신뢰되지 않은 발급자 서명**: 신뢰체인 미확립 시 로드 거부되어야 한다.
96. **EC-096 | 재서명 누락 커밋**: 커밋 전 검증 명령으로 `Valid` 아닌 파일을 탐지해야 한다.
97. **EC-097 | 인증서 만료**: 만료 인증서 서명 파일은 검증 단계에서 실패해야 한다.
98. **EC-098 | 인증서 교체 후 혼재 서명**: 구/신 인증서 혼재 상태의 허용 정책을 명확히 해야 한다.
99. **EC-099 | 테스트 스크립트 서명 정책 불일치**: 운영 코드와 테스트 코드의 서명 정책 구분이 문서화되어야 한다.
100. **EC-100 | 배포 전 전체 서명 스윕 누락**: 릴리스 직전 일괄 검증 절차가 실패하면 배포를 차단해야 한다.

